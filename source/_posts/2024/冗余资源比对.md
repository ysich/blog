---
title: 冗余资源比对
date: 2024-09-12 15:52:56
tags: 性能优化 资源管理
---

# 冗余资源比对

在项目不断迭代的过程中，随着人员和版本的增多，资源文件操作不规范的问题也很容易体现出来。

比如同一份相同图片可能存在与不同的图集文件夹内，导致打图集的适合会打两张重复的图集。

比对相同内容的方式也很简单，使用MD5计算每个Asset文件的MD5值，最终比对MD5值来判断是否是同一文件。（PS：这里也可以用CRC进行比对）一开始只想着做图片内容的比对，查了一下相关的比对方式：直方图比对、模板比对、功能比对(抓取图像特征)等等，这些方式都只是做相似度比对，而且效率都不高并且只能兼顾到图像，直接放弃。

而使用MD5算法则可以比对所有的资源类型，MD5又是哈希算法，哈希算法的特点就是快速、难冲突、输入敏感只要有一点不同则哈希值也会是不同的。

一次性检索所有的资源那将是巨量的，editor又只能单线程执行，会导致卡非常久。最好的方式就是分类型分路径。使用`AssetDatabase.FindAssets(findTag, folders);`，使用不同的filter来筛选不同类型的Asset。

我们还可以在打包前进行检查，在出包前解决这些冗余资源。

查找结果：

![img](https://cdn.nlark.com/yuque/0/2023/png/22888641/1702545328839-33c6c5fa-816b-427c-84e4-6b256b713c3b.png)

单个文件占用有高达160kb的。

![img](https://cdn.nlark.com/yuque/0/2023/png/22888641/1702545462683-9000d182-4711-4989-a990-fb9ee7ca3e64.png)



接下来就是相同资源的合并操作了。

图片资源修改前需要注意：

1. 代码中动态设置的图片
2. 预制中静态设置的图片
3. 有些组件的特殊逻辑，比如Editor设置SpriteName，Runtime时根据SpriteName读取Altas信息。这个就比较需要注意，需要额外工具去查找。
4. 配置中配置的图片



## 图片相似度比对法



有些图片可能美术裁切的时候会相差几个空白像素，导致生成的MD5不一致。这时候可以用直方图计算相似度，进而筛选出大概相似的图片再进行人工筛选。但是由于直方图计算非常耗时，当图片资源比较多的时候可能都得算上一两天，所以可能还没有人工查看的性价比高。

[SaberZG/SimilarTextureCheckToolPublic: 一个用于检测项目内相似图片，并提供替换/删除的工具 (github.com)](https://github.com/SaberZG/SimilarTextureCheckToolPublic)